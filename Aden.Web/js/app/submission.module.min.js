function createSubmissionGridActionButtons(n,t){var i="",u=t.data.canCancel,f=t.data.canStart,e=t.data.canReopen,o=t.data.canWaiver,s=t.data.canReview,h=t.data.startDisabled,c=t.data.reopenDisabled,r=t.data.id,l=t.data.fileNumber,a=t.data.dataYear;s&&(i+='<a class="btn btn-default btn-sm btn-grid" href="/report/'+a+"/"+l+'">Review File<\/a>&nbsp;');u&&(i+='<a href="/audit/'+r+'" class="btn btn-default btn-sm btn-grid" data-cancel data-title="Reason for Reset" data-submission-id='+r+'><i class="fa fa-spinner fa-spin hidden"><\/i> Reset<\/a>&nbsp;');e&&(i+='<a href="/reopenaudit/'+r+'" class="btn btn-default btn-sm btn-grid" data-reopen data-title="ReOpen Reason" data-submission-id='+r,c&&(i+=' disabled data-toggle="tooltip" data-placement="left" title="Missing group assignments or report action"'),i+='><i class="fa fa-spinner fa-spin hidden"><\/i> ReOpen<\/a>&nbsp;');f&&(i+='<a href="#" class="btn btn-default btn-sm btn-grid" data-start data-submission-id='+r,h&&(i+=' disabled data-toggle="tooltip" data-placement="left" title="Missing group assignments or report action"'),i+='><i class="fa fa-spinner fa-spin hidden"><\/i> Start<\/a>&nbsp;');o&&(i+='<a href="/audit/'+r+'" class="btn btn-default btn-sm btn-grid" data-waiver data-title="Waiver Reason" data-submission-id='+r+'><i class="fa fa-spinner fa-spin hidden"><\/i> Waiver<\/a>&nbsp;');n.append(i)}function rowStyle(n,t){var i=["active","success","info","warning","danger"],r=window.moment();return n==="Completed"||n==="Waived"?i[1]:n==="CompleteWithErrors"?i[2]:n!=="Completed"&&r.isSameOrAfter(t)?i[4]:n!=="Completed"&&r.add(14,"days").isSameOrAfter(t)?i[3]:""}function rowPrepared(n){if(n.rowType==="data"){var t=rowStyle(n.data.submissionStateDisplay,n.data.dueDate);n.rowElement.addClass(t)}}$(function(){function i(t){window.$toggleWorkingButton(t);$.ajax({url:"/api/submission/start/"+id,type:"POST"}).done(function(){n.refresh().done(function(n){console.log("done",n)});window.$log.success("Created assignment")}).fail(function(n){window.$log.error("Something went wrong: "+n.responseJSON.message)}).always(function(){window.$toggleWorkingButton(btn,"off")})}function r(t,i){var r=i.id;window.$toggleWorkingButton(t);$.ajax({url:"/api/submission/cancel/"+r,type:"POST"}).done(function(){n.refresh().done(function(n){console.log("done",n)});window.$log.success("Cancelled assignments")}).fail(function(n){window.$log.error("Something went wrong: "+n.responseJSON.message)}).always(function(){window.$toggleWorkingButton(t,"off")})}function u(t,i){var r="/reopenaudit/"+i.id,u="Reopen Reason",f="/api/submission/reopen/"+i.id;$.ajax({url:r,type:"GET",success:function(){window.BootstrapDialog.show({size:window.BootstrapDialog.SIZE_WIDE,draggable:!0,title:u,message:$("<div><\/div>").load(r,function(n,t){t==="error"&&window.$log.error("Error showing history")}),buttons:[{label:"Close",action:function(n){n.close()}},{label:"Save",cssClass:"btn-primary",action:function(t){window.$showModalWorking();$.ajax({type:"POST",url:f,data:$("form").serialize(),dataType:"json",success:function(){n.refresh().done(function(n){console.log("done",n)});window.$log.success("ReOpened submission")},error:function(n){console.log("error",n);window.$log.error("Error: "+n.responseJSON.message)},complete:function(){t.close();window.$hideModalWorking()}})}}]})},error:function(){window.$log.error("Error showing audit entry")}})}function f(t,i){var u="Waiver Reason",r="/audit/"+i.id,f="/api/submission/waiver/"+i.id;$.ajax({url:r,type:"GET",success:function(){window.BootstrapDialog.show({size:window.BootstrapDialog.SIZE_WIDE,draggable:!0,title:u,message:$("<div><\/div>").load(r,function(n,t){t==="error"&&window.$log.error("Error showing history")}),buttons:[{label:"Close",action:function(n){n.close()}},{label:"Save",cssClass:"btn-primary",action:function(t){window.$showModalWorking();$.ajax({type:"POST",url:f,data:$("form").serialize(),dataType:"json",success:function(){n.refresh().done(function(n){console.log("done",n)});window.$log.success("Waived submission")},error:function(n){window.$log.error("Error: "+n.responseJSON.message)},complete:function(){t.close();window.$hideModalWorking()}})}}]})},error:function(){window.$log.error("Error showing audit entry")}})}console.log("submission ready");var t="/api/submission",n=$("#grid").dxDataGrid({dataSource:DevExpress.data.AspNet.createStore({key:"id",loadUrl:t,updateUrl:t}),remoteOperations:!0,columns:[{type:"buttons",buttons:["edit","delete"]},{dataField:"fileNumber",caption:"File Number"},{dataField:"fileName",caption:"File Name"},{dataField:"submissionStateDisplay",caption:"Status"},{dataField:"currentAssignee",caption:"Assigned"},{dataField:"lastUpdatedFriendly",caption:"Last Update"},{dataField:"deadlineDate",caption:"Submission Deadline",dataType:"date"},{dataField:"submissionDate",caption:"Date Submitted",dataType:"date"},{dataField:"displayDataYear",caption:"Data Year"},{dataField:"section",caption:"Section"},{dataField:"isSEA",caption:"SEA",dataType:"boolean",visible:!0,showEditorAlways:!1,trueText:"Yes",falseText:"No",customizeText:function(n){return n.value?"Yes":"No"}},{dataField:"isLEA",caption:"LEA",dataType:"boolean",visible:!0,showEditorAlways:!1,trueText:"Yes",falseText:"No",customizeText:function(n){return n.value?"Yes":"No"}},{dataField:"isSCH",caption:"SCH",dataType:"boolean",visible:!0,showEditorAlways:!1,trueText:"Yes",falseText:"No",customizeText:function(n){return n.value?"Yes":"No"}},{width:200,alignment:"center",cellTemplate:function(n,t){t.data.canStart&&$("<a/>").addClass("btn btn-default btn-sm btn-grid").text("Start").on("dxclick",function(){console.log("container",n);i($(this),t.data)}).appendTo(n);t.data.canCancel&&$("<a/>").addClass("btn btn-default btn-sm btn-grid").text("Cancel").on("dxclick",function(){r($(this),t.data)}).appendTo(n);t.data.canReview&&$("<a/>").addClass("btn btn-default btn-sm btn-grid").text("Review File").attr("href","/report/"+t.data.dataYear+"/"+t.data.fileNumber).attr("target","_blank").appendTo(n);t.data.canReopen&&$("<a/>").addClass("btn btn-default btn-sm btn-grid").text("Reopen").on("dxclick",function(){u($(this),t.data)}).appendTo(n);t.data.canWaiver&&$("<a/>").addClass("btn btn-default btn-sm btn-grid").text("Waiver").on("dxclick",function(){f($(this),t.data)}).appendTo(n)}},],wordWrapEnabled:!0,allowColumnResizing:!0,columnResizingMode:"nextColumn",columnAutoWidth:!0,columnChooser:{enabled:!0},stateStoring:{enabled:!0,type:"localStorage",storageKey:"gridFilterStorage"},filterRow:{visible:!0},headerFilter:{visible:!0},groupPanel:{visible:!0},scrolling:{mode:"virtual"},height:800,sortByGroupSummaryInfo:[{summaryItem:"count"}],summary:{totalItems:[{column:"id",displayFormat:"{0} Total Submissions",summaryType:"count",showInGroupFooter:!0,showInColumn:"FileNumber"},],groupItems:[{summaryType:"count",displayFormat:"{0} Submissions"},]},onToolbarPreparing:function(n){var t=n.component;n.toolbarOptions.items.unshift({location:"after",widget:"dxButton",options:{text:"Collapse All",width:136,onClick:function(n){var i=n.component.option("text")==="Expand All";t.option("grouping.autoExpandAll",i);n.component.option("text",i?"Collapse All":"Expand All")}}},{location:"after",widget:"dxButton",options:{icon:"refresh",onClick:function(){t.refresh()}}},{location:"after",widget:"dxButton",options:{icon:"fa fa-undo",onClick:function(){t.state({})}}})}}).dxDataGrid("instance");$(document).on("click","[data-waiver]",function(t){t.preventDefault();var i=$(this),u=i.data("submission-id"),f=i.data("title"),r=$(this).attr("href"),e="/api/submission/waiver/"+u;$.ajax({url:r,type:"GET",success:function(){window.BootstrapDialog.show({size:window.BootstrapDialog.SIZE_WIDE,draggable:!0,title:f,message:$("<div><\/div>").load(r,function(n,t){t==="error"&&window.$log.error("Error showing history")}),buttons:[{label:"Close",action:function(n){n.close()}},{label:"Save",cssClass:"btn-primary",action:function(t){window.$showModalWorking();$.ajax({type:"POST",url:e,data:$("form").serialize(),dataType:"json",success:function(){n.refresh().done(function(n){console.log("done",n)});window.$log.success("Waived submission")},error:function(n){window.$log.error("Error: "+n.responseJSON.message)},complete:function(){t.close();window.$hideModalWorking()}})}}]})},error:function(){window.$log.error("Error showing audit entry")}})});$(document).on("click","[data-start]",function(t){var i,r;t.preventDefault();i=$(this);window.$toggleWorkingButton(i);r=i.data("submission-id");$.ajax({url:"/api/submission/start/"+r,type:"POST"}).done(function(){n.refresh().done(function(n){console.log("done",n)});window.$log.success("Created assignment")}).fail(function(n){window.$log.error("Something went wrong: "+n.responseJSON.message)}).always(function(){window.$toggleWorkingButton(i,"off")})});$(document).on("click","[data-reopen]",function(t){t.preventDefault();var i=$(this),u=i.data("title"),f=i.data("submission-id"),r=$(this).attr("href"),e="/api/submission/reopen/"+f;console.log("posturl");$.ajax({url:r,type:"GET",success:function(){window.BootstrapDialog.show({size:window.BootstrapDialog.SIZE_WIDE,draggable:!0,title:u,message:$("<div><\/div>").load(r,function(n,t){t==="error"&&window.$log.error("Error showing history")}),buttons:[{label:"Close",action:function(n){n.close()}},{label:"Save",cssClass:"btn-primary",action:function(t){window.$showModalWorking();$.ajax({type:"POST",url:e,data:$("form").serialize(),dataType:"json",success:function(){n.refresh().done(function(n){console.log("done",n)});window.$log.success("ReOpened submission")},error:function(n){console.log("error",n);window.$log.error("Error: "+n.responseJSON.message)},complete:function(){t.close();window.$hideModalWorking()}})}}]})},error:function(){window.$log.error("Error showing audit entry")}})});$(document).on("click","[data-cancel]",function(t){var i,r;t.preventDefault();i=$(this);window.$toggleWorkingButton(i);r=i.data("submission-id");$.ajax({url:"/api/submission/cancel/"+r,type:"POST"}).done(function(){n.refresh().done(function(n){console.log("done",n)});window.$log.success("Cancelled assignments")}).fail(function(n){window.$log.error("Something went wrong: "+n.responseJSON.message)}).always(function(){window.$toggleWorkingButton(i,"off")})});$(document).on("click","[data-history]",function(n){n.preventDefault();var t=$(this).attr("href"),i=$(this).data("title");console.log("url",t);window.BootstrapDialog.show({size:window.BootstrapDialog.SIZE_WIDE,draggable:!0,title:i,message:$("<div><\/div>").load(t,function(n,t){t==="error"&&window.$log.error("Error showing history")}),buttons:[{label:"Close",action:function(n){n.close()}}]})});$(document).on("click","[data-reassign]",function(n){n.preventDefault();var i=$(this).data("workitem-id"),r="Reassign Task",t=$(this).attr("href")+"/"+i;$.ajax({url:t,type:"POST",success:function(){window.BootstrapDialog.show({size:window.BootstrapDialog.SIZE_WIDE,draggable:!0,title:r,message:$("<div><\/div>").load(t,function(n,t){t==="error"&&window.$log.error("Error showing history")}),buttons:[{label:"Close",action:function(n){n.close()}},{label:"Save",cssClass:"btn-primary",action:function(n){window.$showModalWorking();var t=$("form").serialize();$.ajax({type:"POST",url:"/api/assignment/reassign",data:model=t}).done(function(){window.$log.success("Reassigned task")}).fail(function(){window.$log.error("Failed to reassign task. "+error)}).always(function(){n.close();window.$hideModalWorking()})}}]})},error:function(){window.$log.error("Error showing reassignment")}})});$(document).on("click","[data-image-viewer]",function(n){n.preventDefault();var t=$(this),i=t.data("workitem-id"),r="/workitemimages/"+i;window.BootstrapDialog.show({size:window.BootstrapDialog.SIZE_WIDE,draggable:!0,title:"Work Item Images",message:$("<div><\/div>").load(r),buttons:[{label:"Close",action:function(n){n.close()}}]})});$('[data-toggle="tooltip"]').tooltip()});